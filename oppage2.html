<!doctype html>
<html lang="en">

<head>
    <title>:: Call Centre :: Operator Page</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="description" content="CCS Bootstrap 4.1.1 Operator">
    <meta name="author" content="Cyrix Powerhouse">

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- VENDOR CSS -->
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/vendor/animate-css/animate.min.css">
    <link rel="stylesheet" href="../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/vendor/sweetalert/sweetalert.css"/>
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/color_skins.css">
</head>
<body class="theme-blue">

<!-- Page Loader -->
<div class="page-loader-wrapper">
    <div class="loader">
        <div class="m-t-30"><img src="../assets/images/thumbnail.png" width="48" height="48" alt="CCS"></div>
        <p>Please wait...</p>
    </div>
</div>
<!-- Overlay For Sidebars -->
<div class="overlay" style="display: none;"></div>

<div id="wrapper">

    <nav class="navbar navbar-fixed-top">
        <div class="container-fluid">

            <div class="navbar-brand">
                <a href="index.html">
                    <img src="../assets/images/logo.png" alt="CCS Logo" class="img-responsive logo">
                    <span class="name">CCS</span>
                </a>
            </div>

            <div class="navbar-right">
                <ul class="list-unstyled clearfix mb-0">
                    <li>
                        <div class="navbar-btn btn-toggle-show">
                            <button type="button" class="btn-toggle-offcanvas"><i class="lnr lnr-menu fa fa-bars"></i></button>
                        </div>
                        <a href="javascript:void(0);" class="btn-toggle-fullwidth btn-toggle-hide"><i class="fa fa-bars"></i></a>
                    </li>
                    <li>
                        <form id="navbar-search" class="navbar-form search-form">
                            <input value="" class="form-control" placeholder="Search here..." type="text">
                            <button type="button" class="btn btn-default"><i class="icon-magnifier"></i></button>
                        </form>
                    </li>
                    <li>
                        <div id="navbar-menu">
                            <ul class="nav navbar-nav">
                                <li>
                                    <a href="javascript:void(0);" class="mega_menu icon-menu" title="Mega Menu">Menu</a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="create_new icon-menu" title="Create New">Refresh</a>
                                </li>
                                <li class="dropdown">
                                    <a href="javascript:void(0);" class="dropdown-toggle icon-menu" data-toggle="dropdown">
                                        <i class="icon-bell"></i>
                                        <span class="notification-dot"></span>
                                    </a>

                                </li>

                                <li class="dropdown">
                                    <a href="javascript:void(0);" class="dropdown-toggle icon-menu" data-toggle="dropdown"><i class="fa fa-language"></i></a>
                                    <ul class="dropdown-menu animated flipInX choose_language">
                                        <li><a href="javascript:void(0);">English</a></li>
                                        <li><a href="javascript:void(0);">Malay</a></li>
                                        <li><a href="javascript:void(0);">Chinese</a></li>
                                        <li><a href="javascript:void(0);">Indian</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown">
                                    <a href="javascript:void(0);" class="dropdown-toggle icon-menu" data-toggle="dropdown">
                                        <img class="rounded-circle" src="../assets/images/user-small2.png" width="30" alt="">
                                    </a>
                                    <div class="dropdown-menu animated flipInY user-profile">
                                        <div class="d-flex p-3 align-items-center">
                                            <div class="drop-left m-r-10">
                                                <img src="../assets/images/user-small2.png" class="rounded" width="50" alt="">
                                            </div>
                                            <div class="drop-right">
                                                <h4>Abdullah Hassan</h4>
                                                <p class="user-name">abdhassan@gmail.com</p>
                                            </div>
                                        </div>
                                        <div class="m-t-10 p-3 drop-list">
                                            <ul class="list-unstyled">
                                                <li><a href="page-profile.html"><i class="icon-user"></i>My Profile</a></li>
                                                <li><a href="app-inbox.html"><i class="icon-envelope-open"></i>Messages</a></li>
                                                <li><a href="javascript:void(0);"><i class="icon-settings"></i>Settings</a></li>
                                                <li class="divider"></li>
                                                <li><a href="page-login.html"><i class="icon-power"></i>Logout</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="leftsidebar" class="sidebar">
        <div class="sidebar-scroll">
            <nav id="leftsidebar-nav" class="sidebar-nav">
                <ul id="main-menu" class="metismenu">
                    <li class="heading">Main</li>
                    <li><a href="indexoperator.html"><i class="icon-home"></i><span>Dashboard</span></a></li>
                    <li><a href="oppage.html"><i class="icon-list"></i><span>Soalan Survey</span></a></li>
                    <li class="heading">App</li>
                    <li><a href="#"><i class="icon-envelope"></i><span>Inbox</span></a></li>
                    <li><a href="#"><i class="icon-calendar"></i><span>Calendar</span></a></li>
                    <li><a href="#"><i class="icon-notebook"></i><span>Taskboard</span></a></li>
                    <li class="heading">Tetapan</li>
                    <li class="middle">
                    <li><a href="#"><i class="icon-settings"></i><span>Operator</span></a></li>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div id="main-content">
        <div class="container-fluid">
            <div class="block-header">
                <div class="row">
                    <div class="col-lg-5 col-md-8 col-sm-12">
                        <h2>Survey</h2>
                    </div>
                    <div class="col-lg-7 col-md-4 col-sm-12 text-right">
                        <ul class="breadcrumb justify-content-end">
                            <li class="breadcrumb-item"><a href="index.html"><i class="icon-home"></i></a></li>
                            <li class="breadcrumb-item">Operator</li>
                            <li class="breadcrumb-item active">Survey</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="row clearfix">
                <div class="col-lg-8 col-md-12">
                    <div class="card w_profile">
                        <div class="body" style="padding-top: 30px; padding-bottom: 30px">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-12">
                                    <div class="profile-image float-md-right"> <img src="../assets/images/user.png" alt=""> </div>
                                </div>
                                <div class="col-lg-8 col-md-8 col-12">
                                    <h4 class="m-t-0 m-b-0">{{sasaran.nama}}</h4>

                                    <p>{{sasaran.alamatetaprumah}}</p>

                                    <div class="row">
                                        <div class="col-4">
                                            <h5>{{sasaran.gender}}</h5>
                                            <small>Jantina</small>
                                        </div>
                                        <div class="col-4">
                                            <h5>{{sasaran.bangsa}}</h5>
                                            <small>Bangsa</small>
                                        </div>
                                        <div class="col-4">
                                            <h5>{{sasaran.lokaliti}}</h5>
                                            <small>Lokasi</small>
                                        </div>
                                    </div>
                                    <div class="m-t-15">
                                        <button class="btn btn-primary js-sweetalert" data-type="ajax-loader">Mula Survey</button>
                                        <button class="btn btn-success">Reset Caller</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h5 class="card-header">Pembuka Kata</h5>
                        <div class="card-body">
                            <h5 class="card-title">Pastikan anda tidak tinggikan suara</h5>
                            <p class="card-text">Selamat pagi/petang {{sasaran.nama}} haraf maaf kerana menggangu. Saya (Nama Operator) ingin membuat.......</p>

                        </div>
                    </div>
                </div>

                <div class="col-lg-4 col-md-12">
                    <div class="card member-card">
                        <div class="header bg-info">
                            <h4 class="m-t-5 text-light"><strong>Operator</strong></h4>
                        </div>
                        <div class="member-img">
                            <a href="javascript:void(0);"><img src="../assets/images/lg/avatar2.jpg" class="rounded-circle" alt="profile-image"></a>
                        </div>
                        <div class="body">
                            <div class="col-12">
                                <h4 class="m-t-5"><strong>Abdullah Hassan</strong></h4>
                                <p class="text-muted">13 / 03 / 2019 <br> Lokasi CCS</p>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-4">
                                    <h5>40</h5>
                                    <small>Survey Berjaya</small>
                                </div>
                                <div class="col-4">
                                    <h5>NB205</h5>
                                    <small>Caller ID</small>
                                </div>
                                <div class="col-4">
                                    <h5>656</h5>
                                    <small>Jumlah Survey</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="row clearfix">
                <div class="col-lg-8 col-md-12">

                    <div class="card">
                        <div class="header">
                            <h2>Nombor Telefon</h2>
                        </div>
                        <div class="body">
                            <div class="table-responsive">
                                <table class="table table-hover m-b-0 c_list">
                                    <thead>
                                    <tr>
                                        <th>
                                            <label class="fancy-checkbox">
                                                <input class="select-all" type="checkbox" name="checkbox">
                                                <span></span>
                                            </label>
                                        </th>
                                        <th>Phone</th>
                                        <th>Tindakan</th>
                                        <th>Status</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr v-for="(s,i) in phoneNumbers">
                                        <td style="width: 50px;">
                                            <label class="fancy-checkbox">
                                                <input class="checkbox-tick" type="checkbox" name="checkbox">
                                                <span></span>
                                            </label>
                                        </td>

                                        <td>
                                            <span class="phone"><i class="fa fa-phone m-r-10"></i>{{s.number}}</span>
                                        </td>
                                        <td>

                                            <button type="button" class="btn btn-info" @click="call(s.number)" title="Edit"><i class="icon-call-out"></i></button>
                                            <!--<button type="button" data-type="confirm" class="btn btn-danger js-sweetalert" title="Delete"><i class="fa fa-refresh"></i></button>-->
                                        </td>
                                        <td>
                                            <select v-model="s.status" class="custom-select" id="inputGroupSelectCallerStatusCategory" required>
                                                <option selected value="" disabled>Pilih...</option>
                                                <option value="salahno">Salah Nombor</option>
                                                <option value="takwujud">Tidak Wujud</option>
                                                <option value="hubungikemudian">Hubungi Kemudian</option>
                                                <option value="takminat">Tidak Berminat</option>
                                            </select>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>




                    <div class="card">
                        <!--<div class="header">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelectQuestionCategory">Kategori Soalan</label>
                                </div>
                                <select class="custom-select" id="inputGroupSelectQuestionCategory" required>
                                    <option selected value="" disabled>Pilih...</option>
                                    <option value="umum">Umum</option>
                                    <option value="feedback">Feedback</option>
                                    <option value="keberkesanan">Keberkesanan</option>
                                </select>
                            </div>
                        </div>-->
                        <div class="body">
                            <div class="table-responsive">
                                <table class="table table-hover m-b-0 c_list">
                                    <thead>
                                    <tr>
                                        <th>Soalan</th>
                                        <th>Ya</th>
                                        <th>Tidak</th>
                                        <th>Tak Pasti</th>
                                    </tr>
                                    </thead>
                                    <tbody v-if="set.length > 1">
                                    <tr v-for="y,j in set[1].questions">
                                        <td>
                                            <p class="c_name">{{y.question}}</p>
                                        </td>
                                        <td>
                                            <div class="fancy-radio">
                                                <label><input :id="j" @click="answerQuestion(1,j,1)" :name="'pilih'+j" value="ya" type="radio" ><span><i></i>Ya</span></label>

                                            </div>
                                        </td>
                                        <td>
                                            <div class="fancy-radio">
                                                <label><input :id="j" @click="answerQuestion(1,j,2)" :name="'pilih'+j" value="tidak" type="radio" ><span><i></i>Tidak</span></label>

                                            </div>
                                        </td>
                                        <td>
                                            <div class="fancy-radio">
                                                <label><input :id="j" @click="answerQuestion(1,j,3)" :name="'pilih'+j" value="takpasti" type="radio" checked><span><i></i>Tak Pasti</span></label>

                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-12">
                    <div class="card">
                        <div class="header">
                            <h2>Comments <small>Komen yang diterima daripada pemanggil.</small></h2>
                        </div>
                        <div class="body">
                            <h6>Jenis Komen</h6>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Options</label>
                                </div>
                                <select v-model="comment_type" class="custom-select" id="inputGroupSelect01">
                                    <option selected>Pilihan...</option>
                                    <option value="1">Info</option>
                                    <option value="2">Wakil Rakyat</option>
                                    <option value="3">Lain-Lain</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Komen</span>
                                </div>
                                <textarea v-model="comment" class="form-control" aria-label="Komen"></textarea>
                            </div>

                        </div>
                    </div>
                    <div class="card">
                        <div class="header">
                            <h2>Adakah anda bersetuju jika kami menghubungi lagi untuk tujuan survey lain?</h2>
                        </div>
                        <div class="body">
                            <div class="fancy-radio">
                                <label><input name="kawalan" v-model="focusgroup" value=1 type="radio" ><span><i></i>Ya</span></label>
                                <label><input name="kawalan" v-model="focusgroup" value=0 type="radio" ><span><i></i>Tidak</span></label>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="body">
                        <h6>Pastikan semua info di atas ada tepat</h6>
                            <a @click="submit()" class="btn btn-success">Submit</a>
                            <button @click="reset()" class="btn btn-danger">Reset</button>
                        </div>
                    </div>
                </div>
            </div>




        </div>
    </div>

</div>

<!-- Javascript -->
<!-- Javascript -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="//unpkg.com/vue-plain-pagination@0.2.1"></script>
<script src="https://unpkg.com/@directus/sdk-js@4.0.0/dist/directus-sdk.umd.min.js"></script>

<script src="assets/bundles/libscripts.bundle.js"></script>
<script src="assets/bundles/vendorscripts.bundle.js"></script>

<script src="../assets/vendor/sweetalert/sweetalert.min.js"></script> <!-- SweetAlert Plugin Js -->

<script src="assets/bundles/knob.bundle.js"></script> <!-- Jquery Knob-->
<script src="assets/bundles/mainscripts.bundle.js"></script>
<script src="assets/bundles/morrisscripts.bundle.js"></script>
<script src="assets/js/pages/ui/dialogs.js"></script>
<script>
    $(function() {
        "use strict";

        $('.knob2').knob({
            'format' : function (value) {
                return value + '%';
            }
        });
    });
</script>
<script>
    const client = new DirectusSDK({
        url: "http://ccs.cyrix.my/cms/public",
    });
    client.getItems("sasaran",{
        fields: "*.*",
        limit: 1,
        filter:{
            answered:0
        }
    }).then(res => {
        //console.log(res.data);
        app.sasaran = res.data[0];
        findPropertyNameByRegex(res.data[0],/tel/);

    });
    client.getItems("set_soalan", {
        fields: "*.*"
    }).then(res => {
        app.set = res.data;
        //console.log(res.data)
        let answers = [];
        let output = [];
        for (let i = 0; i < 3; i++) {
            let data = {
                answers: [0, 0, 0],
            };
            answers.push(data);
            output.push("");
        }
        app.answers = answers;
        app.output = output;
    });

    function findPropertyNameByRegex(o, r) {
        for (var key in o) {
            //console.log(key.match(r))
            if (key.match(r) && o[key]) {
                let data = {
                    key:key,
                    number : o[key],
                    status : null,
                }
                app.phoneNumbers.push(data);
            }
        }
    };

    function parseAnswers(data = [0, 0, 0]) {
        let output = "";
        let a = data[0];
        let b = data[1];
        let c = data[2];
        if (calculateWhite(a, b, c)) {
            output = 1;
        }

        if (calculateGreyWhite(a, b, c)) {
            output = 2;
        }

        if (calculateGrey(a, b, c)) {
            output = 3;
        }

        if (calculateGreyBlack(a, b, c)) {
            output = 4;
        }

        if (calculateBlack(a, b, c)) {
            output = 5;
        }

        return output;
    }

    function calculateWhite(a, b, c) {
        let val = false;

        if (a === 1 && b === 1 && c === 2) {
            val = true;
        }

        if (a === 1 && b === 2 && c === 2) {
            val = true;
        }

        if (a === 1 && b === 3 && c === 2) {
            val = true;
        }

        if (a === 3 && b === 2 && c === 2) {
            val = true;
        }
        return val;
    }

    function calculateGreyWhite(a, b, c) {
        let val = false;
        if (a === 1 && b === 2 && c === 3) {
            val = true;
        }

        if (a === 1 && b === 3 && c === 3) {
            val = true;
        }

        if (a === 2 && b === 2 && c === 2) {
            val = true;
        }

        if (a === 3 && b === 2 && c === 3) {
            val = true;
        }

        if (a === 3 && b === 3 && c === 2) {
            val = true;
        }
        return val;
    }

    function calculateGrey(a, b, c) {
        let val = false;
        if (a === 1 && b === 1 && c === 3) {
            val = true;
        }

        if (a === 1 && b === 2 && c === 1) {
            val = true;
        }

        if (a === 1 && b === 3 && c === 1) {
            val = true;
        }

        if (a === 2 && b === 1 && c === 2) {
            val = true;
        }

        if (a === 2 && b === 2 && c === 3) {
            val = true;
        }

        if (a === 2 && b === 3 && c === 2) {
            val = true;
        }

        if (a === 3 && b === 1 && c === 2) {
            val = true;
        }

        if (a === 3 && b === 3 && c === 3) {
            val = true;
        }
        return val;
    }

    function calculateGreyBlack(a, b, c) {
        let val = false;
        if (a === 1 && b === 1 && c === 1) {
            val = true;
        }

        if (a === 2 && b === 1 && c === 3) {
            val = true;
        }

        if (a === 2 && b === 3 && c === 3) {
            val = true;
        }

        if (a === 3 && b === 1 && c === 3) {
            val = true;
        }

        if (a === 3 && b === 2 && c === 1) {
            val = true;
        }
        return val;
    }

    function calculateBlack(a, b, c) {
        let val = false;
        if (a === 2 && b === 1 && c === 1) {
            val = true;
        }

        if (a === 2 && b === 2 && c === 1) {
            val = true;
        }

        if (a === 2 && b === 3 && c === 1) {
            val = true;
        }

        if (a === 3 && b === 1 && c === 1) {
            val = true;
        }

        if (a === 3 && b === 3 && c === 1) {
            val = true;
        }
        return val;
    }
    //Vue.component('v-pagination', window['vue-plain-pagination']);
    let app = new Vue({
        el: '#main-content',
        data: {
            phoneNumbers : [],
            sasaran: {},
            set: [],
            focusgroup: "0",
            comment: "",
            comment_type: "",
            tel_status: [],
            answers: [],
            output: [],
            res : 0,
            currentPage: 1,
            total: 1,
        },
        methods: {
            call: function(no){
                window.open(
                    `mydialer://${no}`,
                    '_blank' // <- This is what makes it open in a new window.
                );
            },
            answerQuestion: function (i, j, k) {
                this.answers[i].answers[j] = k;
                console.log(this.answers[i].answers);
                let res = parseAnswers(this.answers[i].answers);
                console.log("RES",res);
                if(res){
                    this.res = res;
                    this.$set(app.output, i, res);
                    console.log("output",this.output);
                }

            },
            submit: function () {
                client.updateItem("sasaran", this.sasaran.id, {
                    answered: 1,
                    focusgroup: parseInt(this.focusgroup),

                });
                client.createItem("jawapan", {
                    set_id: this.set[1].id,
                    user_id: this.sasaran.id,
                    result: this.res
                }).then((res1) => {
                    client.updateItem("sasaran", this.sasaran.id, {
                        answered: 1,
                        focusgroup: this.focusgroup,

                    }).then((res2) =>{
                        client.createItem("status_tel", {
                            user_id: this.sasaran.id,
                            tel_status: JSON.stringify(this.tel_status),
                            comment_type:this.comment_type,
                            comment:this.comment
                        }).then((res3)=>{
                            console.log(res3);
                        });
                    });
                });



                alert("Success");
                this.reset();
            },
            reset: function () {
                let answers = [];
                let output = [];
                for (let i = 0; i < 3; i++) {
                    let data = {
                        answers: [0, 0, 0],
                    };
                    answers.push(data);
                    output.push("");
                }
                app.answers = answers;
                app.output = output;
                app.res = 0;
                location.reload();
                //alert("resetted");
            }
        }
    });

</script>
</body>
</html>
